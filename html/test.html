<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>首頁</title>

<!-- Swiper CDN -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" /> <!-- [web:7] -->

<style>
  :root{
    --bg1:#f7d6e6; --bg2:#fbe9f2; --card:#ffffffcc;
    --pink:#ff6fa5; --pink2:#ff86b4; --text:#4a2b36;
    --muted:#7b5a66; --shadow: 0 10px 22px rgba(0,0,0,.12);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", sans-serif;
    color:var(--text);
    background: radial-gradient(1200px 600px at 30% 10%, var(--bg2), var(--bg1));
  }
  body.modal-open{ overflow:hidden; } /* 鎖背景滾動 [web:8] */

  .app{ max-width:520px; margin:0 auto; min-height:100vh; padding:0 12px 78px; }

  /* Swiper banner */
  .bannerWrap{ margin: 10px 0 8px; border-radius:18px; overflow:hidden; box-shadow: var(--shadow); background:#000; }
  .swiper{ width:100%; height:280px; }
  .swiper-slide{ position:relative; }
  .swiper-slide img{ width:100%; height:100%; object-fit:cover; display:block; }
  .bannerText{
    position:absolute; left:14px; bottom:12px;
    font-weight:1000; font-size:44px; letter-spacing:2px;
    color:#fff; text-shadow: 0 6px 14px rgba(0,0,0,.55);
    z-index:2;
  }
  .bannerStripe{
    position:absolute; left:0; right:0; bottom:14px; height:22px;
    background: rgba(255,140,0,.7); transform: skewX(-10deg);
    z-index:1;
  }

  /* Search area */
  .searchWrap{
    background: linear-gradient(180deg, rgba(122,60,255,.55), rgba(255,255,255,.0));
    border-radius: 18px; padding: 12px; margin: 10px 0;
  }
  .searchRow{ display:flex; align-items:center; gap:10px; }
  .avatar{ width:44px; height:44px; border-radius:999px; overflow:hidden; background:#fff; box-shadow:0 6px 14px rgba(0,0,0,.12); }
  .avatar img{ width:100%; height:100%; object-fit:cover; display:block; }
  .searchBox{
    flex:1; display:flex; align-items:center; gap:10px;
    background: rgba(255,255,255,.25);
    border: 1px solid rgba(255,255,255,.35);
    border-radius: 999px; padding: 10px 14px; color:#fff;
  }
  .searchBox input{ flex:1; border:none; outline:none; background:transparent; color:#fff; font-weight:800; }
  .searchBox input::placeholder{ color: rgba(255,255,255,.85); }
  .adv{ color:#fff; font-weight:1000; white-space:nowrap; }
  .marqueeRow{ display:flex; align-items:center; gap:10px; margin-top:8px; color:#fff; font-weight:1000; font-size:13px; }
  .marquee{ flex:1; overflow:hidden; white-space:nowrap; opacity:.95; }
  .marquee span{ display:inline-block; padding-left:100%; animation:scroll 12s linear infinite; }
  @keyframes scroll { 0%{ transform: translateX(0);} 100%{ transform: translateX(-100%);} }

  /* Location bar */
  .locRow{
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    background: linear-gradient(90deg, rgba(255,255,255,.55), rgba(255,255,255,.15));
    border-radius: 14px; padding: 10px 12px; margin: 10px 0 14px;
    box-shadow: 0 10px 18px rgba(0,0,0,.08);
  }
  .locText{ font-weight:1000; color:#6b2d52; }
  .switchBtn{
    border:none; border-radius:999px; padding:8px 12px; font-weight:1000;
    background: rgba(122,60,255,.25); color:#4a2b36;
  }

  /* Leaderboard title */
  .leaderTitleWrap{ display:flex; align-items:center; justify-content:center; margin: 6px 0 10px; }
  .diamond{
    width: 100%; border-radius: 18px; padding: 14px 0; text-align:center;
    background: linear-gradient(90deg, #ff4f8e, #ffb300);
    clip-path: polygon(6% 0, 94% 0, 100% 50%, 94% 100%, 6% 100%, 0 50%);
    box-shadow: var(--shadow);
    color:#fff; font-weight:1000; letter-spacing:3px; font-size:20px;
  }

  /* Modal (城市清單) */
  .modal{
    display:none;
    position:fixed; inset:0;
    background: rgba(0,0,0,.45);
    z-index: 9999;
    padding: 18px 12px;
  }
  .modal.open{ display:block; } /* 顯示/隱藏 [web:8] */
  .modalPanel{
    max-width: 520px;
    margin: 60px auto 0;
    background: rgba(255,255,255,.9);
    border-radius: 18px;
    box-shadow: var(--shadow);
    overflow:hidden;
  }
  .modalHeader{
    display:flex; align-items:center; justify-content:space-between;
    padding: 12px 14px;
    background: linear-gradient(90deg, rgba(255,111,165,.35), rgba(122,60,255,.18));
    font-weight: 1000;
  }
  .modalBody{ padding: 10px; max-height: 60vh; overflow:auto; }
  .cityBtn{
    width:100%;
    border:1px solid rgba(0,0,0,.08);
    background:#fff;
    padding: 12px 12px;
    border-radius: 14px;
    text-align:left;
    font-weight: 900;
    margin: 8px 0;
  }
  .cityBtn.active{ border-color: rgba(255,47,124,.6); color:#ff2f7c; }

  /* TabBar (略，保留你原本的) */
  .tabbar{
    position: fixed; left:50%; transform: translateX(-50%); bottom:0;
    width: min(520px, 100%);
    background: rgba(255,255,255,.75);
    backdrop-filter: blur(10px);
    border-top: 1px solid rgba(0,0,0,.06);
    display:flex; justify-content: space-around;
    padding: 10px 6px 14px;
  }
  .tab{ display:flex; flex-direction:column; align-items:center; gap:4px; font-size:12px; color:#7a5c66; font-weight:900; }
  .tab.active{ color:#ff2f7c; }
</style>
</head>

<body>
  <div class="app" id="app"></div>

  <!-- City Modal -->
  <div class="modal" id="cityModal" role="dialog" aria-modal="true">
    <div class="modalPanel">
      <div class="modalHeader">
        <div>切換城市</div>
        <button id="closeCityModal" style="border:none;background:transparent;font-weight:1000;">✕</button>
      </div>
      <div class="modalBody" id="cityList"></div>
    </div>
  </div>

  <div class="tabbar" id="tabbar"></div>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script> <!-- [web:7] -->
<script>
  const ICONS = {
    search:`<svg viewBox="0 0 24 24" style="width:18px;height:18px;opacity:.95"><path d="M10 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16Zm11 3-6-6" stroke="#fff" stroke-width="2" fill="none" stroke-linecap="round"/></svg>`
  };

  let APP_DATA = null;

  async function main(){
    const res = await fetch('https://raw.githubusercontent.com/eric21364/eric21364.github.io/refs/heads/main/html/data.json');
    APP_DATA = await res.json();
    renderTop(APP_DATA);
    renderTabs(APP_DATA.tabs || []);
    bindModal(APP_DATA);
    initSwiper(); // 輪播初始化 [web:7]
  }

  function renderTop(data){
    const app = document.getElementById('app');

    const banners = data.topBanners || [];
    const searchBar = data.searchBar || {};
    const currentCity = data.currentCity || '台中';
    const leaderboard = data.leaderboard || {};

    app.innerHTML = `
      <div class="bannerWrap">
        <div class="swiper">
          <div class="swiper-wrapper">
            ${banners.map(b => `
              <div class="swiper-slide">
                <img src="${escapeAttr(b.image||'')}" alt="">
                <div class="bannerStripe"></div>
                <div class="bannerText">${escapeHtml(b.titleText||'')}</div>
              </div>
            `).join('')}
          </div>
        </div>
      </div>

      <div class="searchWrap">
        <div class="searchRow">
          <div class="avatar"><img src="${escapeAttr(searchBar.avatar||'')}" alt=""></div>
          <div class="searchBox">
            <input value="" placeholder="${escapeAttr(searchBar.placeholder||'')}" />
            ${ICONS.search}
          </div>
          <div class="adv">${escapeHtml(searchBar.advancedText||'')}</div>
        </div>
        <div class="marqueeRow">
          <div style="font-weight:1000">${escapeHtml(searchBar.soundText||'')}</div>
          <div class="marquee"><span>${escapeHtml(searchBar.marquee||'')}</span></div>
        </div>
      </div>

      <div class="locRow">
        <div class="locText" id="locText">位置：${escapeHtml(currentCity)}</div>
        <button class="switchBtn" id="openCityModal" type="button">切換城市</button>
      </div>

      <div class="leaderTitleWrap">
        <div class="diamond">${escapeHtml(leaderboard.title||'')}</div>
      </div>

      <!-- 這裡接你原本的卡片列表 -->
      <div style="color:#6b2d52;font-weight:900;opacity:.85;padding:8px 2px;">
        （卡片列表沿用你先前的 renderCards 直接接回來）
      </div>
    `;
  }

  function initSwiper(){
    // Swiper loop + autoplay 範例 [web:7]
    new Swiper('.swiper', {
      loop: true,
      autoplay: { delay: 3000, disableOnInteraction: false },
      speed: 500
    });
  }

  function bindModal(data){
    const modal = document.getElementById('cityModal');
    const openBtn = document.getElementById('openCityModal');
    const closeBtn = document.getElementById('closeCityModal');
    const list = document.getElementById('cityList');

    function openModal(){
      modal.classList.add('open');
      document.body.classList.add('modal-open'); // 鎖滾動 [web:8]
      renderCityList();
    }
    function closeModal(){
      modal.classList.remove('open');
      document.body.classList.remove('modal-open'); // 解鎖 [web:8]
    }

    function renderCityList(){
      const cities = data.cities || [];
      const cur = data.currentCity;
      list.innerHTML = cities.map(c => `
        <button class="cityBtn ${c===cur?'active':''}" data-city="${escapeAttr(c)}">${escapeHtml(c)}</button>
      `).join('');

      list.querySelectorAll('.cityBtn').forEach(btn => {
        btn.addEventListener('click', () => {
          data.currentCity = btn.dataset.city;
          document.getElementById('locText').textContent = `位置：${data.currentCity}`;
          closeModal();
        });
      });
    }

    openBtn?.addEventListener('click', openModal);
    closeBtn?.addEventListener('click', closeModal);

    // 點背景關閉 [web:8]
    modal.addEventListener('click', (e) => {
      if (e.target === modal) closeModal();
    });

    // ESC 關閉（可選）
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modal.classList.contains('open')) closeModal();
    });
  }

  function renderTabs(tabs){
    const tb = document.getElementById('tabbar');
    tb.innerHTML = tabs.map((t, i) => `
      <div class="tab ${i===0?'active':''}" data-key="${escapeAttr(t.key)}">
        <div style="width:22px;height:22px;border-radius:8px;background:#ffd1e2;opacity:.9"></div>
        <div>${escapeHtml(t.label||'')}</div>
      </div>
    `).join('');
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  }
  function escapeAttr(s){ return escapeHtml(s); }

  main();
</script>
</body>
</html>
