<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨˜å¸³çµ±è¨ˆ - æœˆ/å¹´åˆ†æç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f4f6f8;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        /* é ‚éƒ¨æ§åˆ¶åˆ— */
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        h2 { margin: 0; color: #2d3748; font-size: 1.2rem; }
        select {
            padding: 8px 12px;
            font-size: 15px;
            border-radius: 6px;
            border: 1px solid #cbd5e0;
            background: #f7fafc;
            cursor: pointer;
            font-weight: 600;
            color: #4a5568;
        }

        /* åˆ†æé¢æ¿ */
        .analysis-panel {
            background: white;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.03);
            margin-bottom: 25px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .stat-group {
            flex: 1;
            min-width: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .stat-label { font-size: 14px; color: #718096; margin-bottom: 4px; }
        .stat-value { font-size: 36px; font-weight: 800; color: #2d3748; letter-spacing: -0.5px; }
        .stat-sub { font-size: 14px; color: #a0aec0; margin-top: 5px; font-weight: 500; }
        
        .trend-up { color: #e53e3e; background: #fff5f5; padding: 2px 6px; border-radius: 4px; }
        .trend-down { color: #38a169; background: #f0fff4; padding: 2px 6px; border-radius: 4px; }

        .chart-container {
            flex: 1;
            min-width: 280px;
            height: 220px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* æ¸…å–®å€åŸŸ */
        .list-header {
            margin: 0 0 10px 5px;
            font-weight: 600;
            color: #4a5568;
        }
        .list-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.03);
            overflow: hidden;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        th {
            background: #f7fafc;
            text-align: left;
            padding: 12px 15px;
            color: #718096;
            font-weight: 600;
            border-bottom: 1px solid #e2e8f0;
        }
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #edf2f7;
            vertical-align: middle;
        }
        
        /* æœˆä»½åˆ†éš”æ¨™é¡Œ */
        .month-separator {
            background-color: #ebf8ff;
            color: #2b6cb0;
            font-weight: bold;
            padding: 8px 15px;
            font-size: 14px;
            border-left: 4px solid #4299e1;
        }

        .money { text-align: right; font-family: monospace; font-weight: 600; font-size: 15px; color: #2d3748; }
        .date-col { color: #718096; width: 60px; }
        
        /* æ¨™ç±¤æ¨£å¼ */
        .tag {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }
        .tag-lunch { background: #e3f2fd; color: #1565c0; }
        .tag-breakfast { background: #fff3e0; color: #ef6c00; }
        .tag-dinner { background: #f3e5f5; color: #7b1fa2; }
        .tag-tea { background: #e0f2f1; color: #00695c; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-bar">
        <h2>ğŸ“Š æ”¶æ”¯åˆ†æçœ‹æ¿</h2>
        <select id="timeSelector" onchange="updateDashboard()"></select>
    </div>

    <div class="analysis-panel">
        <div class="stat-group">
            <div>
                <div class="stat-label" id="mainLabel">æœ¬æœˆç¸½æ”¯å‡º</div>
                <div class="stat-value" id="displayTotal">$0</div>
                <div class="stat-sub" id="displayTrend">--</div>
            </div>
            
            <div style="margin-top: 25px; display: flex; gap: 30px;">
                <div>
                    <div class="stat-label">æ¶ˆè²»ç­†æ•¸</div>
                    <div style="font-size: 20px; font-weight: 700;" id="displayCount">0</div>
                </div>
                <div>
                    <div class="stat-label">å¹³å‡æ¯ç­†</div>
                    <div style="font-size: 20px; font-weight: 700;" id="displayAvg">$0</div>
                </div>
            </div>
        </div>
        
        <div class="chart-container">
            <canvas id="mainChart"></canvas>
        </div>
    </div>

    <div class="list-header" id="listTitle">è©³ç´°è¨˜éŒ„</div>
    <div class="list-container">
        <table id="recordTable">
            <thead>
                <tr>
                    <th class="date-col">æ—¥æœŸ</th>
                    <th>æ™‚æ®µ</th>
                    <th>é …ç›®</th>
                    <th style="text-align: right;">é‡‘é¡</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
    </div>
</div>

<script>
    // 1. åŸå§‹è³‡æ–™
    const rawCsvData = `
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ30æ—¥ ä¸Šåˆ8:45 (GMT+8),110
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ29æ—¥ ä¸Šåˆ9:46 (GMT+8),120
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2026å¹´1æœˆ30æ—¥ ä¸Šåˆ8:01 (GMT+8),49
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ28æ—¥ ä¸Šåˆ7:59 (GMT+8),100
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ19æ—¥ ä¸Šåˆ8:21 (GMT+8),100
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ21æ—¥ ä¸Šåˆ9:44 (GMT+8),110
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2026å¹´1æœˆ19æ—¥ ä¸Šåˆ7:52 (GMT+8),145
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ26æ—¥ ä¸Šåˆ10:35 (GMT+8),75
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2026å¹´1æœˆ9æ—¥ ä¸Šåˆ8:02 (GMT+8),35
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2026å¹´1æœˆ8æ—¥ ä¸Šåˆ8:08 (GMT+8),180
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ15æ—¥ ä¸Šåˆ11:57 (GMT+8),89
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´12æœˆ18æ—¥ ä¸‹åˆ2:18 (GMT+8),169
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´12æœˆ17æ—¥ ä¸Šåˆ7:52 (GMT+8),167
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2026å¹´1æœˆ6æ—¥ ä¸Šåˆ8:33 (GMT+8),42
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´12æœˆ16æ—¥ ä¸‹åˆ5:33 (GMT+8),100
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´12æœˆ10æ—¥ ä¸Šåˆ8:08 (GMT+8),45
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´12æœˆ2æ—¥ ä¸Šåˆ8:08 (GMT+8),84
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´12æœˆ1æ—¥ ä¸Šåˆ9:43 (GMT+8),100
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´11æœˆ26æ—¥ ä¸Šåˆ8:05 (GMT+8),89
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ17æ—¥ ä¸Šåˆ9:42 (GMT+8),100
é¤é£²-æ™šé¤,é¤é£²,æ™šé¤,2026å¹´1æœˆ15æ—¥ ä¸‹åˆ6:16 (GMT+8),125
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2026å¹´1æœˆ29æ—¥ ä¸Šåˆ8:35 (GMT+8),36
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ14æ—¥ ä¸Šåˆ8:35 (GMT+8),120
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ26æ—¥ ä¸‹åˆ1:16 (GMT+8),173
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2026å¹´1æœˆ28æ—¥ ä¸Šåˆ7:58 (GMT+8),36
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ16æ—¥ ä¸‹åˆ12:11 (GMT+8),99
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ12æ—¥ ä¸‹åˆ3:27 (GMT+8),120
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ14æ—¥ ä¸Šåˆ9:07 (GMT+8),155
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2026å¹´1æœˆ13æ—¥ ä¸Šåˆ9:42 (GMT+8),100
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´11æœˆ6æ—¥ ä¸Šåˆ8:02 (GMT+8),110
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´11æœˆ11æ—¥ ä¸Šåˆ8:00 (GMT+8),74
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2026å¹´1æœˆ13æ—¥ ä¸Šåˆ8:10 (GMT+8),36
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ6æ—¥ ä¸Šåˆ9:45 (GMT+8),110
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ30æ—¥ ä¸Šåˆ9:59 (GMT+8),110
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´12æœˆ26æ—¥ ä¸Šåˆ8:04 (GMT+8),84
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ28æ—¥ ä¸Šåˆ9:42 (GMT+8),100
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´12æœˆ29æ—¥ ä¸Šåˆ7:52 (GMT+8),39
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´12æœˆ27æ—¥ ä¸Šåˆ8:18 (GMT+8),94
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´12æœˆ24æ—¥ ä¸Šåˆ7:49 (GMT+8),84
é¤é£²-æ™šé¤,é¤é£²,æ™šé¤,2025å¹´10æœˆ20æ—¥ ä¸‹åˆ6:33 (GMT+8),125
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ11æ—¥ ä¸‹åˆ6:21 (GMT+8),169
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ20æ—¥ ä¸Šåˆ9:44 (GMT+8),100
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´12æœˆ12æ—¥ ä¸Šåˆ8:03 (GMT+8),45
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´10æœˆ29æ—¥ ä¸Šåˆ8:02 (GMT+8),74
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´12æœˆ29æ—¥ ä¸Šåˆ7:51 (GMT+8),179
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´12æœˆ11æ—¥ ä¸Šåˆ7:58 (GMT+8),55
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ2æ—¥ ä¸‹åˆ2:09 (GMT+8),127
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´12æœˆ22æ—¥ ä¸Šåˆ10:15 (GMT+8),100
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´12æœˆ9æ—¥ ä¸Šåˆ7:58 (GMT+8),86
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2026å¹´1æœˆ12æ—¥ ä¸Šåˆ8:06 (GMT+8),31
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ5æ—¥ ä¸Šåˆ9:39 (GMT+8),100
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´12æœˆ23æ—¥ ä¸Šåˆ7:50 (GMT+8),75
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2026å¹´1æœˆ5æ—¥ ä¸Šåˆ7:52 (GMT+8),64
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´12æœˆ8æ—¥ ä¸Šåˆ9:45 (GMT+8),100
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´12æœˆ3æ—¥ ä¸‹åˆ2:14 (GMT+8),100
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ28æ—¥ ä¸Šåˆ10:01 (GMT+8),130
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´11æœˆ27æ—¥ ä¸Šåˆ7:56 (GMT+8),79
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´12æœˆ11æ—¥ ä¸‹åˆ12:10 (GMT+8),58
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´12æœˆ10æ—¥ ä¸‹åˆ12:59 (GMT+8),89
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´10æœˆ20æ—¥ ä¸Šåˆ8:48 (GMT+8),89
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ14æ—¥ ä¸‹åˆ8:57 (GMT+8),121
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ13æ—¥ ä¸‹åˆ8:58 (GMT+8),100
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ15æ—¥ ä¸Šåˆ9:34 (GMT+8),110
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ9æ—¥ ä¸‹åˆ5:12 (GMT+8),132
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ18æ—¥ ä¸Šåˆ8:08 (GMT+8),169
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ25æ—¥ ä¸Šåˆ11:36 (GMT+8),100
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´10æœˆ22æ—¥ ä¸Šåˆ8:05 (GMT+8),74
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ25æ—¥ ä¸Šåˆ11:35 (GMT+8),120
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´11æœˆ18æ—¥ ä¸Šåˆ8:04 (GMT+8),94
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´11æœˆ19æ—¥ ä¸Šåˆ8:08 (GMT+8),50
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´11æœˆ17æ—¥ ä¸Šåˆ7:53 (GMT+8),13
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ7æ—¥ ä¸‹åˆ5:11 (GMT+8),90
é¤é£²-æ™šé¤,é¤é£²,æ™šé¤,2025å¹´11æœˆ12æ—¥ ä¸‹åˆ6:21 (GMT+8),125
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ12æ—¥ ä¸‹åˆ6:21 (GMT+8),141
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ13æ—¥ ä¸Šåˆ11:22 (GMT+8),110
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´10æœˆ13æ—¥ ä¸Šåˆ8:28 (GMT+8),64
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´11æœˆ14æ—¥ ä¸Šåˆ8:03 (GMT+8),74
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ10æ—¥ ä¸Šåˆ8:00 (GMT+8),100
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´11æœˆ3æ—¥ ä¸Šåˆ8:10 (GMT+8),55
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ5æ—¥ ä¸Šåˆ11:52 (GMT+8),124
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ4æ—¥ ä¸Šåˆ9:39 (GMT+8),82
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ3æ—¥ ä¸Šåˆ9:45 (GMT+8),100
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ4æ—¥ ä¸Šåˆ11:52 (GMT+8),25
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ31æ—¥ ä¸Šåˆ8:34 (GMT+8),120
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ29æ—¥ ä¸Šåˆ10:04 (GMT+8),110
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ23æ—¥ ä¸‹åˆ2:01 (GMT+8),169
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ22æ—¥ ä¸Šåˆ8:42 (GMT+8),120
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´10æœˆ21æ—¥ ä¸Šåˆ7:57 (GMT+8),94
é¤é£²-ä¸‹åˆèŒ¶,é¤é£²,ä¸‹åˆèŒ¶,2025å¹´10æœˆ19æ—¥ ä¸‹åˆ1:48 (GMT+8),65
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ21æ—¥ ä¸Šåˆ9:55 (GMT+8),110
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ16æ—¥ ä¸Šåˆ9:16 (GMT+8),120
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´10æœˆ15æ—¥ ä¸Šåˆ8:09 (GMT+8),74
é¤é£²-ä¸‹åˆèŒ¶,é¤é£²,ä¸‹åˆèŒ¶,2025å¹´10æœˆ17æ—¥ ä¸‹åˆ1:28 (GMT+8),65
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ17æ—¥ ä¸Šåˆ9:56 (GMT+8),70
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´10æœˆ16æ—¥ ä¸Šåˆ7:57 (GMT+8),25
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ20æ—¥ ä¸Šåˆ11:35 (GMT+8),175
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ20æ—¥ ä¸Šåˆ8:02 (GMT+8),175
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ27æ—¥ ä¸Šåˆ9:39 (GMT+8),100
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´10æœˆ31æ—¥ ä¸Šåˆ7:51 (GMT+8),42
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´11æœˆ21æ—¥ ä¸Šåˆ7:57 (GMT+8),59
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ8æ—¥ ä¸‹åˆ5:11 (GMT+8),65
é¤é£²-æ™šé¤,é¤é£²,æ™šé¤,2025å¹´11æœˆ18æ—¥ ä¸Šåˆ8:08 (GMT+8),175
`;

    let allTransactions = [];
    let myChart = null;

    // 2. è§£æè³‡æ–™
    function parseData(csv) {
        const lines = csv.trim().split('\n');
        const result = [];
        lines.forEach(line => {
            if (!line.trim()) return;
            const parts = line.split(',');
            if (parts.length < 5) return;

            const dateStr = parts[3];
            let formattedDate = dateStr;
            const dateMatch = dateStr.match(/(\d{4})å¹´(\d{1,2})æœˆ(\d{1,2})æ—¥/);
            
            if (dateMatch) {
                const y = dateMatch[1];
                const m = dateMatch[2].padStart(2, '0');
                const d = dateMatch[3].padStart(2, '0');
                formattedDate = `${y}-${m}-${d}`;
            }

            result.push({
                date: formattedDate,
                year: formattedDate.substring(0, 4), // 2026
                yearMonth: formattedDate.substring(0, 7), // 2026-01
                item: parts[0],
                subCategory: parts[2],
                amount: parseInt(parts[4])
            });
        });
        return result.sort((a, b) => new Date(b.date) - new Date(a.date));
    }

    // 3. åˆå§‹åŒ–ä¸¦å»ºç«‹é¸å–®
    function init() {
        allTransactions = parseData(rawCsvData);
        
        // å–å¾—æ‰€æœ‰ä¸é‡è¤‡çš„ã€Œå¹´ã€å’Œã€Œå¹´æœˆã€
        const uniqueYears = [...new Set(allTransactions.map(t => t.year))].sort().reverse();
        const uniqueMonths = [...new Set(allTransactions.map(t => t.yearMonth))].sort().reverse();
        
        const selector = document.getElementById('timeSelector');

        // å»ºç«‹é¸å–®ï¼šå…ˆæ”¾ã€Œå¹´ä»½ã€ï¼Œå…¶ä¸‹è·Ÿè‘—è©²å¹´çš„ã€Œæœˆä»½ã€
        uniqueYears.forEach(year => {
            // 1. åŠ å…¥å¹´ä»½é¸é …
            const yearOption = document.createElement('option');
            yearOption.value = year;
            yearOption.text = `ğŸ“… ${year}å¹´ å…¨å¹´åº¦`;
            yearOption.style.fontWeight = "bold";
            selector.appendChild(yearOption);

            // 2. åŠ å…¥è©²å¹´ä»½åº•ä¸‹çš„æœˆä»½é¸é …
            const monthsInYear = uniqueMonths.filter(m => m.startsWith(year));
            monthsInYear.forEach(m => {
                const monthOption = document.createElement('option');
                monthOption.value = m;
                monthOption.text = `ã€€ ${m.split('-')[1]} æœˆ`; // ç¸®æ’ç¾è§€
                selector.appendChild(monthOption);
            });
        });

        // é è¨­é¸å–æœ€æ–°çš„æœˆä»½ (å¦‚æœæœ‰)
        if (uniqueMonths.length > 0) {
            // é è¨­é¸ç¬¬äºŒå€‹ (å› ç‚ºç¬¬ä¸€å€‹é€šå¸¸æ˜¯å¹´ä»½)
             // é‚è¼¯ï¼šçœ‹ç¬¬ä¸€å€‹é¸é …æ˜¯ä¸æ˜¯æœ€æ–°æœˆä»½ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±é¸ç¬¬ä¸€å€‹æœˆä»½
             // ç‚ºäº†ç°¡å–®ï¼Œç›´æ¥è§¸ç™¼æ›´æ–°
             if(selector.options.length > 1) {
                 selector.selectedIndex = 1; // é è¨­é¸æœ€æ–°æœˆä»½ï¼Œè·³éå…¨å¹´
             }
        }
        
        updateDashboard();
    }

    // 4. æ›´æ–°å„€è¡¨æ¿ (æ ¸å¿ƒé‚è¼¯)
    function updateDashboard() {
        const selectedValue = document.getElementById('timeSelector').value;
        const isYearlyMode = !selectedValue.includes('-'); // å¦‚æœåªæœ‰å¹´ä»½ (å¦‚ 2025) æ²’æœ‰ - 
        
        let filteredData = [];
        let comparisonLabel = "";
        let diff = 0;
        let mainLabelText = "";

        if (isYearlyMode) {
            // --- å¹´ä»½æ¨¡å¼ ---
            const year = selectedValue;
            mainLabelText = `${year}å¹´ ç¸½æ”¯å‡º`;
            filteredData = allTransactions.filter(t => t.year === year);
            
            // æ¯”è¼ƒå‰ä¸€å¹´
            const prevYear = (parseInt(year) - 1).toString();
            const prevData = allTransactions.filter(t => t.year === prevYear);
            const currentTotal = filteredData.reduce((sum, t) => sum + t.amount, 0);
            const prevTotal = prevData.reduce((sum, t) => sum + t.amount, 0);
            
            diff = currentTotal - prevTotal;
            if (prevData.length === 0) comparisonLabel = "ç„¡å»å¹´è³‡æ–™";
            else comparisonLabel = diff > 0 ? `â–² æ¯”å»å¹´å¤š $${diff.toLocaleString()}` : `â–¼ æ¯”å»å¹´å°‘ $${Math.abs(diff).toLocaleString()}`;

        } else {
            // --- æœˆä»½æ¨¡å¼ ---
            const month = selectedValue;
            mainLabelText = `${month.split('-')[1]}æœˆ ç¸½æ”¯å‡º`;
            filteredData = allTransactions.filter(t => t.yearMonth === month);

            // æ¯”è¼ƒä¸Šå€‹æœˆ
            const [y, m] = month.split('-').map(Number);
            const prevDate = new Date(y, m - 2, 1);
            const prevMonthStr = `${prevDate.getFullYear()}-${String(prevDate.getMonth()+1).padStart(2,'0')}`;
            
            const prevData = allTransactions.filter(t => t.yearMonth === prevMonthStr);
            const currentTotal = filteredData.reduce((sum, t) => sum + t.amount, 0);
            const prevTotal = prevData.reduce((sum, t) => sum + t.amount, 0);

            diff = currentTotal - prevTotal;
            if (prevData.length === 0) comparisonLabel = "ç„¡ä¸Šæœˆè³‡æ–™";
            else comparisonLabel = diff > 0 ? `â–² æ¯”ä¸Šæœˆå¤š $${diff.toLocaleString()}` : `â–¼ æ¯”ä¸Šæœˆå°‘ $${Math.abs(diff).toLocaleString()}`;
        }

        // è¨ˆç®—æ•¸å€¼
        const total = filteredData.reduce((sum, t) => sum + t.amount, 0);
        const count = filteredData.length;
        const avg = count > 0 ? Math.round(total / count) : 0;

        // æ›´æ–° UI æ–‡å­—
        document.getElementById('mainLabel').innerText = mainLabelText;
        document.getElementById('displayTotal').innerText = `$${total.toLocaleString()}`;
        document.getElementById('displayCount').innerText = `${count} ç­†`;
        document.getElementById('displayAvg').innerText = `$${avg}`;
        
        const trendElem = document.getElementById('displayTrend');
        trendElem.innerText = comparisonLabel;
        trendElem.className = diff > 0 ? 'stat-sub trend-up' : (diff < 0 ? 'stat-sub trend-down' : 'stat-sub');
        if(comparisonLabel.includes("ç„¡")) trendElem.className = 'stat-sub';

        // æ›´æ–°åœ–è¡¨
        updateChart(filteredData);
        
        // æ›´æ–°æ¸…å–® (åªå‚³å…¥éæ¿¾å¾Œçš„è³‡æ–™)
        renderTable(filteredData);
    }

    // 5. æ›´æ–°åœ–è¡¨
    function updateChart(data) {
        const subCounts = {};
        data.forEach(t => {
            if (!subCounts[t.subCategory]) subCounts[t.subCategory] = 0;
            subCounts[t.subCategory] += t.amount;
        });

        const ctx = document.getElementById('mainChart').getContext('2d');
        if (myChart) myChart.destroy();

        myChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: Object.keys(subCounts),
                datasets: [{
                    data: Object.values(subCounts),
                    backgroundColor: ['#4299e1', '#ed8936', '#9f7aea', '#38b2ac', '#f56565', '#667eea'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'right' },
                    title: { display: false }
                },
                cutout: '75%'
            }
        });
    }

    // 6. æ¸²æŸ“æ¸…å–® (åªé¡¯ç¤ºå‚³å…¥çš„è³‡æ–™)
    function renderTable(data) {
        const tbody = document.querySelector("#recordTable tbody");
        tbody.innerHTML = "";
        
        if (data.length === 0) {
            tbody.innerHTML = `<tr><td colspan="4" style="text-align:center; padding: 20px; color:#aaa;">ç„¡è³‡æ–™</td></tr>`;
            return;
        }

        let lastMonth = "";

        data.forEach(t => {
            // åŠ å…¥æœˆä»½åˆ†éš”æ¨™é¡Œ
            if (t.yearMonth !== lastMonth) {
                tbody.innerHTML += `
                    <tr style="background:white;">
                        <td colspan="4" style="padding:0;">
                            <div class="month-separator">
                                ${t.yearMonth}
                            </div>
                        </td>
                    </tr>
                `;
                lastMonth = t.yearMonth;
            }

            // æ¨£å¼
            let tagClass = '';
            if (t.subCategory === 'åˆé¤') tagClass = 'tag-lunch';
            else if (t.subCategory === 'æ—©é¤') tagClass = 'tag-breakfast';
            else if (t.subCategory === 'æ™šé¤') tagClass = 'tag-dinner';
            else tagClass = 'tag-tea';

            const row = `
                <tr>
                    <td>${t.date.slice(5)}</td>
                    <td><span class="tag ${tagClass}">${t.subCategory}</span></td>
                    <td>${t.item}</td>
                    <td class="money">$${t.amount}</td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }

    init();

</script>

</body>
</html>
