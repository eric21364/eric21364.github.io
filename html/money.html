<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å€‹äººè¨˜å¸³çµ±è¨ˆ - æœˆä»½åˆ†æç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        /* é ‚éƒ¨æ§åˆ¶åˆ— */
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        h2 { margin: 0; color: #1a202c; }
        select {
            padding: 8px 12px;
            font-size: 16px;
            border-radius: 8px;
            border: 1px solid #cbd5e0;
            background: white;
            cursor: pointer;
        }

        /* åˆ†æé¢æ¿ (é‡é»å€åŸŸ) */
        .analysis-panel {
            background: white;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.03);
            margin-bottom: 25px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .stat-group {
            flex: 1;
            min-width: 200px;
        }
        .stat-label { font-size: 14px; color: #718096; margin-bottom: 5px; }
        .stat-value { font-size: 32px; font-weight: 800; color: #2d3748; }
        .stat-sub { font-size: 13px; color: #a0aec0; margin-top: 5px; }
        .trend-up { color: #e53e3e; } /* æ”¯å‡ºå¢åŠ æ˜¯ç´…å­— */
        .trend-down { color: #38a169; } /* æ”¯å‡ºæ¸›å°‘æ˜¯ç¶ å­— */

        .chart-container {
            flex: 1;
            min-width: 280px;
            height: 220px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* æ¸…å–®å€åŸŸ */
        .list-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.03);
            overflow: hidden;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        th {
            background: #f7fafc;
            text-align: left;
            padding: 15px;
            color: #718096;
            font-weight: 600;
            border-bottom: 1px solid #e2e8f0;
        }
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #edf2f7;
        }
        
        /* æœˆä»½åˆ†éš”æ¨™é¡Œ */
        .month-separator {
            background-color: #ebf8ff;
            color: #2b6cb0;
            font-weight: bold;
            padding: 10px 15px;
            font-size: 15px;
        }

        .money { text-align: right; font-family: monospace; font-weight: 600; font-size: 15px; }
        
        /* æ¨™ç±¤æ¨£å¼ */
        .tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }
        .tag-lunch { background: #e3f2fd; color: #1565c0; }
        .tag-breakfast { background: #fff3e0; color: #ef6c00; }
        .tag-dinner { background: #f3e5f5; color: #7b1fa2; }
        .tag-tea { background: #e0f2f1; color: #00695c; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-bar">
        <h2>ğŸ’° è¨˜å¸³åˆ†æçœ‹æ¿</h2>
        <select id="monthSelector" onchange="updateDashboard()">
            </select>
    </div>

    <div class="analysis-panel">
        <div class="stat-group">
            <div class="stat-label">æœ¬æœˆç¸½æ”¯å‡º</div>
            <div class="stat-value" id="monthTotal">$0</div>
            <div class="stat-sub" id="monthComparison">æ­£åœ¨è¨ˆç®—...</div>
            
            <div style="margin-top: 20px;">
                <div class="stat-label">å¹³å‡æ¯é¤èŠ±è²»</div>
                <div class="stat-value" style="font-size: 24px;" id="monthAvg">$0</div>
            </div>
            <div style="margin-top: 10px;">
                <div class="stat-label">æ¶ˆè²»ç­†æ•¸</div>
                <div class="stat-value" style="font-size: 24px;" id="monthCount">0</div>
            </div>
        </div>
        
        <div class="chart-container">
            <canvas id="monthChart"></canvas>
        </div>
    </div>

    <div class="list-container">
        <table id="recordTable">
            <thead>
                <tr>
                    <th>æ—¥æœŸ</th>
                    <th>æ™‚æ®µ</th>
                    <th>é …ç›®</th>
                    <th style="text-align: right;">é‡‘é¡</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
    </div>
</div>

<script>
    // 1. åŸå§‹è³‡æ–™
    const rawCsvData = `
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ30æ—¥ ä¸Šåˆ8:45 (GMT+8),110
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ29æ—¥ ä¸Šåˆ9:46 (GMT+8),120
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2026å¹´1æœˆ30æ—¥ ä¸Šåˆ8:01 (GMT+8),49
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ28æ—¥ ä¸Šåˆ7:59 (GMT+8),100
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ19æ—¥ ä¸Šåˆ8:21 (GMT+8),100
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ21æ—¥ ä¸Šåˆ9:44 (GMT+8),110
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2026å¹´1æœˆ19æ—¥ ä¸Šåˆ7:52 (GMT+8),145
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ26æ—¥ ä¸Šåˆ10:35 (GMT+8),75
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2026å¹´1æœˆ9æ—¥ ä¸Šåˆ8:02 (GMT+8),35
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2026å¹´1æœˆ8æ—¥ ä¸Šåˆ8:08 (GMT+8),180
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ15æ—¥ ä¸Šåˆ11:57 (GMT+8),89
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´12æœˆ18æ—¥ ä¸‹åˆ2:18 (GMT+8),169
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´12æœˆ17æ—¥ ä¸Šåˆ7:52 (GMT+8),167
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2026å¹´1æœˆ6æ—¥ ä¸Šåˆ8:33 (GMT+8),42
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´12æœˆ16æ—¥ ä¸‹åˆ5:33 (GMT+8),100
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´12æœˆ10æ—¥ ä¸Šåˆ8:08 (GMT+8),45
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´12æœˆ2æ—¥ ä¸Šåˆ8:08 (GMT+8),84
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´12æœˆ1æ—¥ ä¸Šåˆ9:43 (GMT+8),100
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´11æœˆ26æ—¥ ä¸Šåˆ8:05 (GMT+8),89
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ17æ—¥ ä¸Šåˆ9:42 (GMT+8),100
é¤é£²-æ™šé¤,é¤é£²,æ™šé¤,2026å¹´1æœˆ15æ—¥ ä¸‹åˆ6:16 (GMT+8),125
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2026å¹´1æœˆ29æ—¥ ä¸Šåˆ8:35 (GMT+8),36
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ14æ—¥ ä¸Šåˆ8:35 (GMT+8),120
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ26æ—¥ ä¸‹åˆ1:16 (GMT+8),173
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2026å¹´1æœˆ28æ—¥ ä¸Šåˆ7:58 (GMT+8),36
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ16æ—¥ ä¸‹åˆ12:11 (GMT+8),99
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ12æ—¥ ä¸‹åˆ3:27 (GMT+8),120
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ14æ—¥ ä¸Šåˆ9:07 (GMT+8),155
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2026å¹´1æœˆ13æ—¥ ä¸Šåˆ9:42 (GMT+8),100
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´11æœˆ6æ—¥ ä¸Šåˆ8:02 (GMT+8),110
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´11æœˆ11æ—¥ ä¸Šåˆ8:00 (GMT+8),74
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2026å¹´1æœˆ13æ—¥ ä¸Šåˆ8:10 (GMT+8),36
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ6æ—¥ ä¸Šåˆ9:45 (GMT+8),110
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ30æ—¥ ä¸Šåˆ9:59 (GMT+8),110
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´12æœˆ26æ—¥ ä¸Šåˆ8:04 (GMT+8),84
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ28æ—¥ ä¸Šåˆ9:42 (GMT+8),100
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´12æœˆ29æ—¥ ä¸Šåˆ7:52 (GMT+8),39
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´12æœˆ27æ—¥ ä¸Šåˆ8:18 (GMT+8),94
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´12æœˆ24æ—¥ ä¸Šåˆ7:49 (GMT+8),84
é¤é£²-æ™šé¤,é¤é£²,æ™šé¤,2025å¹´10æœˆ20æ—¥ ä¸‹åˆ6:33 (GMT+8),125
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ11æ—¥ ä¸‹åˆ6:21 (GMT+8),169
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ20æ—¥ ä¸Šåˆ9:44 (GMT+8),100
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´12æœˆ12æ—¥ ä¸Šåˆ8:03 (GMT+8),45
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´10æœˆ29æ—¥ ä¸Šåˆ8:02 (GMT+8),74
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´12æœˆ29æ—¥ ä¸Šåˆ7:51 (GMT+8),179
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´12æœˆ11æ—¥ ä¸Šåˆ7:58 (GMT+8),55
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ2æ—¥ ä¸‹åˆ2:09 (GMT+8),127
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´12æœˆ22æ—¥ ä¸Šåˆ10:15 (GMT+8),100
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´12æœˆ9æ—¥ ä¸Šåˆ7:58 (GMT+8),86
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2026å¹´1æœˆ12æ—¥ ä¸Šåˆ8:06 (GMT+8),31
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2026å¹´1æœˆ5æ—¥ ä¸Šåˆ9:39 (GMT+8),100
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´12æœˆ23æ—¥ ä¸Šåˆ7:50 (GMT+8),75
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2026å¹´1æœˆ5æ—¥ ä¸Šåˆ7:52 (GMT+8),64
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´12æœˆ8æ—¥ ä¸Šåˆ9:45 (GMT+8),100
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´12æœˆ3æ—¥ ä¸‹åˆ2:14 (GMT+8),100
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ28æ—¥ ä¸Šåˆ10:01 (GMT+8),130
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´11æœˆ27æ—¥ ä¸Šåˆ7:56 (GMT+8),79
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´12æœˆ11æ—¥ ä¸‹åˆ12:10 (GMT+8),58
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´12æœˆ10æ—¥ ä¸‹åˆ12:59 (GMT+8),89
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´10æœˆ20æ—¥ ä¸Šåˆ8:48 (GMT+8),89
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ14æ—¥ ä¸‹åˆ8:57 (GMT+8),121
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ13æ—¥ ä¸‹åˆ8:58 (GMT+8),100
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ15æ—¥ ä¸Šåˆ9:34 (GMT+8),110
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ9æ—¥ ä¸‹åˆ5:12 (GMT+8),132
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ18æ—¥ ä¸Šåˆ8:08 (GMT+8),169
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ25æ—¥ ä¸Šåˆ11:36 (GMT+8),100
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´10æœˆ22æ—¥ ä¸Šåˆ8:05 (GMT+8),74
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ25æ—¥ ä¸Šåˆ11:35 (GMT+8),120
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´11æœˆ18æ—¥ ä¸Šåˆ8:04 (GMT+8),94
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´11æœˆ19æ—¥ ä¸Šåˆ8:08 (GMT+8),50
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´11æœˆ17æ—¥ ä¸Šåˆ7:53 (GMT+8),13
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ7æ—¥ ä¸‹åˆ5:11 (GMT+8),90
é¤é£²-æ™šé¤,é¤é£²,æ™šé¤,2025å¹´11æœˆ12æ—¥ ä¸‹åˆ6:21 (GMT+8),125
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ12æ—¥ ä¸‹åˆ6:21 (GMT+8),141
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ13æ—¥ ä¸Šåˆ11:22 (GMT+8),110
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´10æœˆ13æ—¥ ä¸Šåˆ8:28 (GMT+8),64
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´11æœˆ14æ—¥ ä¸Šåˆ8:03 (GMT+8),74
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ10æ—¥ ä¸Šåˆ8:00 (GMT+8),100
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´11æœˆ3æ—¥ ä¸Šåˆ8:10 (GMT+8),55
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ5æ—¥ ä¸Šåˆ11:52 (GMT+8),124
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ4æ—¥ ä¸Šåˆ9:39 (GMT+8),82
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ3æ—¥ ä¸Šåˆ9:45 (GMT+8),100
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ4æ—¥ ä¸Šåˆ11:52 (GMT+8),25
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ31æ—¥ ä¸Šåˆ8:34 (GMT+8),120
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ29æ—¥ ä¸Šåˆ10:04 (GMT+8),110
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ23æ—¥ ä¸‹åˆ2:01 (GMT+8),169
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ22æ—¥ ä¸Šåˆ8:42 (GMT+8),120
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´10æœˆ21æ—¥ ä¸Šåˆ7:57 (GMT+8),94
é¤é£²-ä¸‹åˆèŒ¶,é¤é£²,ä¸‹åˆèŒ¶,2025å¹´10æœˆ19æ—¥ ä¸‹åˆ1:48 (GMT+8),65
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ21æ—¥ ä¸Šåˆ9:55 (GMT+8),110
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ16æ—¥ ä¸Šåˆ9:16 (GMT+8),120
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´10æœˆ15æ—¥ ä¸Šåˆ8:09 (GMT+8),74
é¤é£²-ä¸‹åˆèŒ¶,é¤é£²,ä¸‹åˆèŒ¶,2025å¹´10æœˆ17æ—¥ ä¸‹åˆ1:28 (GMT+8),65
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ17æ—¥ ä¸Šåˆ9:56 (GMT+8),70
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´10æœˆ16æ—¥ ä¸Šåˆ7:57 (GMT+8),25
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ20æ—¥ ä¸Šåˆ11:35 (GMT+8),175
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´11æœˆ20æ—¥ ä¸Šåˆ8:02 (GMT+8),175
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ27æ—¥ ä¸Šåˆ9:39 (GMT+8),100
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´10æœˆ31æ—¥ ä¸Šåˆ7:51 (GMT+8),42
é¤é£²-æ—©é¤,é¤é£²,æ—©é¤,2025å¹´11æœˆ21æ—¥ ä¸Šåˆ7:57 (GMT+8),59
é¤é£²-åˆé¤,é¤é£²,åˆé¤,2025å¹´10æœˆ8æ—¥ ä¸‹åˆ5:11 (GMT+8),65
é¤é£²-æ™šé¤,é¤é£²,æ™šé¤,2025å¹´11æœˆ18æ—¥ ä¸Šåˆ8:08 (GMT+8),175
`;

    let allTransactions = [];
    let myChart = null;

    // 2. è§£æè³‡æ–™
    function parseData(csv) {
        const lines = csv.trim().split('\n');
        const result = [];
        
        lines.forEach(line => {
            if (!line.trim()) return;
            const parts = line.split(',');
            if (parts.length < 5) return;

            const dateStr = parts[3];
            let formattedDate = dateStr;
            const dateMatch = dateStr.match(/(\d{4})å¹´(\d{1,2})æœˆ(\d{1,2})æ—¥/);
            
            if (dateMatch) {
                const y = dateMatch[1];
                const m = dateMatch[2].padStart(2, '0');
                const d = dateMatch[3].padStart(2, '0');
                formattedDate = `${y}-${m}-${d}`;
            }

            result.push({
                date: formattedDate,
                yearMonth: formattedDate.substring(0, 7), // ex: 2026-01
                item: parts[0],
                subCategory: parts[2],
                amount: parseInt(parts[4])
            });
        });
        
        // æŒ‰æ—¥æœŸé™åº
        return result.sort((a, b) => new Date(b.date) - new Date(a.date));
    }

    // 3. åˆå§‹åŒ–
    function init() {
        allTransactions = parseData(rawCsvData);
        
        // å–å¾—æ‰€æœ‰ä¸é‡è¤‡çš„æœˆä»½
        const uniqueMonths = [...new Set(allTransactions.map(t => t.yearMonth))];
        
        // å¡«å……é¸å–®
        const selector = document.getElementById('monthSelector');
        uniqueMonths.forEach(m => {
            const option = document.createElement('option');
            option.value = m;
            option.text = m.replace('-', 'å¹´ ') + 'æœˆ';
            selector.appendChild(option);
        });

        // é è¨­é¸å–æœ€æ–°çš„æœˆä»½ (2026-01)
        if (uniqueMonths.length > 0) {
            selector.value = uniqueMonths[0]; 
        }

        renderTable(); // æ¸²æŸ“åˆ—è¡¨(å…¨éƒ¨)
        updateDashboard(); // æ¸²æŸ“åˆ†æé¢æ¿(é‡å°é¸ä¸­æœˆä»½)
    }

    // 4. æ›´æ–°åˆ†æé¢æ¿ (æ ¸å¿ƒé‚è¼¯)
    function updateDashboard() {
        const selectedMonth = document.getElementById('monthSelector').value;
        const currentData = allTransactions.filter(t => t.yearMonth === selectedMonth);
        
        // è¨ˆç®—ç¸½é¡èˆ‡å¹³å‡
        const total = currentData.reduce((sum, t) => sum + t.amount, 0);
        const count = currentData.length;
        const avg = count > 0 ? Math.round(total / count) : 0;

        // è¨ˆç®—ä¸Šå€‹æœˆæ¯”è¼ƒ
        const [currY, currM] = selectedMonth.split('-').map(Number);
        const prevDate = new Date(currY, currM - 2, 1); // JSæœˆä»½å¾0é–‹å§‹ï¼Œæ‰€ä»¥æ¸›2æ˜¯ä¸Šå€‹æœˆ
        const prevMonthStr = `${prevDate.getFullYear()}-${String(prevDate.getMonth()+1).padStart(2,'0')}`;
        const prevData = allTransactions.filter(t => t.yearMonth === prevMonthStr);
        const prevTotal = prevData.reduce((sum, t) => sum + t.amount, 0);
        
        // æ›´æ–°æ–‡å­—
        document.getElementById('monthTotal').innerText = `$${total.toLocaleString()}`;
        document.getElementById('monthAvg').innerText = `$${avg}`;
        document.getElementById('monthCount').innerText = `${count} ç­†`;

        const diff = total - prevTotal;
        const comparisonElem = document.getElementById('monthComparison');
        if (prevData.length === 0) {
            comparisonElem.innerText = "ç„¡ä¸Šæœˆè³‡æ–™å¯æ¯”è¼ƒ";
            comparisonElem.className = "stat-sub";
        } else {
            const trendText = diff > 0 ? `â–² æ¯”ä¸Šæœˆå¤š $${diff.toLocaleString()}` : `â–¼ æ¯”ä¸Šæœˆå°‘ $${Math.abs(diff).toLocaleString()}`;
            const trendClass = diff > 0 ? 'trend-up' : 'trend-down';
            comparisonElem.innerHTML = `<span class="${trendClass}">${trendText}</span>`;
        }

        // æº–å‚™åœ–è¡¨è³‡æ–™
        const subCounts = {};
        currentData.forEach(t => {
            if (!subCounts[t.subCategory]) subCounts[t.subCategory] = 0;
            subCounts[t.subCategory] += t.amount;
        });

        drawChart(subCounts);
    }

    // 5. ç¹ªåœ–
    function drawChart(dataObj) {
        const ctx = document.getElementById('monthChart').getContext('2d');
        
        if (myChart) {
            myChart.destroy();
        }

        myChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: Object.keys(dataObj),
                datasets: [{
                    data: Object.values(dataObj),
                    backgroundColor: ['#4299e1', '#ed8936', '#9f7aea', '#38b2ac', '#f56565'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'right' },
                    title: { display: false }
                },
                cutout: '70%'
            }
        });
    }

    // 6. æ¸²æŸ“åˆ—è¡¨ (å«æœˆä»½åˆ†éš”ç·š)
    function renderTable() {
        const tbody = document.querySelector("#recordTable tbody");
        tbody.innerHTML = "";
        
        let lastMonth = "";

        allTransactions.forEach(t => {
            // æ’å…¥æœˆä»½æ¨™é¡Œåˆ—
            if (t.yearMonth !== lastMonth) {
                const headerRow = `
                    <tr style="background:transparent;">
                        <td colspan="4" style="padding:0;">
                            <div class="month-separator">
                                ğŸ“… ${t.yearMonth.replace('-', 'å¹´ ')}æœˆ
                            </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += headerRow;
                lastMonth = t.yearMonth;
            }

            // æ¨£å¼
            let tagClass = '';
            if (t.subCategory === 'åˆé¤') tagClass = 'tag-lunch';
            else if (t.subCategory === 'æ—©é¤') tagClass = 'tag-breakfast';
            else if (t.subCategory === 'æ™šé¤') tagClass = 'tag-dinner';
            else tagClass = 'tag-tea';

            const row = `
                <tr>
                    <td>${t.date.slice(5)}</td> <td><span class="tag ${tagClass}">${t.subCategory}</span></td>
                    <td>${t.item}</td>
                    <td class="money">$${t.amount}</td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }

    // å•Ÿå‹•
    init();

</script>

</body>
</html>
