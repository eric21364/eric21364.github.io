<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>強迫下載 PDF 工具</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f0f2f5; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .box { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); width: 450px; text-align: center; }
        input { width: 100%; padding: 12px; margin: 15px 0; border: 2px solid #eee; border-radius: 8px; font-size: 14px; transition: 0.3s; }
        input:focus { border-color: #007bff; outline: none; }
        button { background: #007bff; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        #status { margin-top: 15px; font-size: 13px; color: #666; }
    </style>
</head>
<body>

<div class="box">
    <h2>PDF 直接下載器</h2>
    <p style="color: #888; font-size: 14px;">繞過瀏覽器預覽，直接儲存檔案</p>
    <input type="text" id="pdfUrl" placeholder="請貼上 PDF 網址或 API 連結">
    <button id="dlBtn" onclick="forceDownload()">開始下載</button>
    <div id="status"></div>
</div>

<script>
async function forceDownload() {
    const url = document.getElementById('pdfUrl').value.trim();
    const btn = document.getElementById('dlBtn');
    const status = document.getElementById('status');

    if (!url) return alert("請輸入網址");

    btn.disabled = true;
    status.innerText = "正在連線並抓取檔案內容...";

    try {
        // 1. 使用 fetch 抓取資料
        const response = await fetch(url);
        
        if (!response.ok) throw new Error("無法取得檔案，請檢查網址或 CORS 限制");

        // 2. 將內容轉為 Blob (Binary Large Object)
        const blob = await response.blob();
        
        // 3. 建立一個暫時性的 URL 指向這個 Blob
        const blobUrl = window.URL.createObjectURL(blob);
        
        // 4. 建立隱藏連結觸發下載
        const a = document.createElement('a');
        a.href = blobUrl;
        
        // 嘗試從網址提取檔名，若無則預設為 document.pdf
        const fileName = url.split('/').pop().split('?')[0] || 'document.pdf';
        a.download = fileName.endsWith('.pdf') ? fileName : fileName + '.pdf';
        
        document.body.appendChild(a);
        a.click();
        
        // 5. 清理資源
        window.URL.revokeObjectURL(blobUrl);
        document.body.removeChild(a);
        
        status.innerText = "下載成功！";
        status.style.color = "green";
    } catch (error) {
        console.error(error);
        status.innerText = "錯誤: " + error.message;
        status.style.color = "red";
        
        // 如果 fetch 失敗 (通常是 CORS 問題)，嘗試回退到普通下載
        status.innerText += " (嘗試嘗試開啟原始連結...)";
        setTimeout(() => {
            window.open(url, '_blank');
        }, 2000);
    } finally {
        btn.disabled = false;
    }
}
</script>

</body>
</html>
