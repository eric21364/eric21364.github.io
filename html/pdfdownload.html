<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>PDF æ‰¹é‡å¼·åˆ¶ä¸‹è¼‰</title>
    <style>
        body { font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f4f4f9; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .card { background: white; padding: 30px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); width: 100%; max-width: 600px; }
        h2 { margin-top: 0; color: #333; font-size: 22px; text-align: center; }
        .input-group { margin: 20px 0; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #555; }
        input[type="text"] { width: 100%; padding: 14px; border: 2px solid #e0e0e0; border-radius: 8px; box-sizing: border-box; font-size: 15px; transition: border-color 0.3s; }
        input[type="text"]:focus { border-color: #007bff; outline: none; }
        button { background: #007bff; color: white; border: none; padding: 14px; border-radius: 8px; cursor: pointer; width: 100%; font-size: 16px; font-weight: bold; transition: 0.2s; }
        button:hover { background: #0056b3; transform: translateY(-1px); }
        button:active { transform: translateY(0); }
        button:disabled { background: #ccc; cursor: not-allowed; }
        #log { margin-top: 20px; background: #fdfdfd; border: 1px solid #eee; border-radius: 8px; padding: 15px; max-height: 200px; overflow-y: auto; display: none; }
        .log-item { font-size: 13px; margin-bottom: 5px; padding-bottom: 5px; border-bottom: 1px solid #f0f0f0; }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
    </style>
</head>
<body>

<div class="card">
    <h2>PDF å¼·åˆ¶ä¸‹è¼‰å·¥å…·</h2>
    <div class="input-group">
        <label>è«‹è¼¸å…¥ç¶²å€ (ç”¨é€—è™Ÿåˆ†éš”)ï¼š</label>
        <input type="text" id="urlInput" placeholder="https://api.a.com/1.pdf, https://api.b.com/2.pdf">
    </div>
    <button id="dlBtn" onclick="runBatchDownload()">ç«‹å³ä¸‹è¼‰æ‰€æœ‰æª”æ¡ˆ</button>
    
    <div id="log"></div>
</div>

<script>
async function runBatchDownload() {
    const rawInput = document.getElementById('urlInput').value.trim();
    const btn = document.getElementById('dlBtn');
    const logBox = document.getElementById('log');

    if (!rawInput) {
        alert("è«‹è¼¸å…¥è‡³å°‘ä¸€å€‹ç¶²å€");
        return;
    }

    // 1. ä½¿ç”¨é€—è™Ÿåˆ†å‰²ä¸¦éæ¿¾ç©ºç™½å­—å…ƒ
    const urls = rawInput.split(',').map(u => u.trim()).filter(u => u !== "");
    
    btn.disabled = true;
    logBox.style.display = "block";
    logBox.innerHTML = "<strong>æº–å‚™ä¸‹è¼‰ä¸­...</strong><hr>";

    for (let i = 0; i < urls.length; i++) {
        const url = urls[i];
        const statusItem = document.createElement('div');
        statusItem.className = 'log-item';
        statusItem.innerText = `[${i+1}/${urls.length}] æ­£åœ¨æŠ“å–: ${url.substring(0, 40)}...`;
        logBox.appendChild(statusItem);
        logBox.scrollTop = logBox.scrollHeight;

        try {
            // æ ¸å¿ƒé‚è¼¯ï¼šä½¿ç”¨ fetch è½‰ Blob å¼·åˆ¶ä¸‹è¼‰
            const response = await fetch(url);
            if (!response.ok) throw new Error("API è«‹æ±‚å¤±æ•—");

            const blob = await response.blob();
            const blobUrl = window.URL.createObjectURL(blob);
            
            // æª”åè™•ç†
            let fileName = url.split('/').pop().split('?')[0];
            if (!fileName || !fileName.includes('.pdf')) {
                fileName = `document_${i+1}.pdf`;
            }

            const a = document.createElement('a');
            a.href = blobUrl;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            
            window.URL.revokeObjectURL(blobUrl);
            document.body.removeChild(a);
            
            statusItem.innerHTML = `<span class="success">âœ“ ä¸‹è¼‰æˆåŠŸ: ${fileName}</span>`;
        } catch (err) {
            statusItem.innerHTML = `<span class="error">âœ— å¤±æ•—: ${err.message}</span>`;
            // å¦‚æœ CORS æ“‹ä½ï¼Œæä¾›æ‰‹å‹•é€£çµ
            const fallback = document.createElement('a');
            fallback.href = url;
            fallback.target = "_blank";
            fallback.innerText = " (é»æ­¤æ‰‹å‹•é–‹å•Ÿ)";
            statusItem.appendChild(fallback);
        }
        
        // ç¨å¾®å»¶é²é¿å…ç€è¦½å™¨è² æ“”éé‡
        await new Promise(r => setTimeout(r, 600));
    }

    btn.disabled = false;
    const finalMsg = document.createElement('div');
    finalMsg.style.textAlign = "center";
    finalMsg.style.paddingTop = "10px";
    finalMsg.innerHTML = "<strong>ğŸ‰ ä¸‹è¼‰ä»»å‹™å·²å®Œæˆ</strong>";
    logBox.appendChild(finalMsg);
}
</script>

</body>
</html>
